<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.2" />
<title>radiology_ai.preprocessing.dicom API documentation</title>
<meta name="description" content="Preprocessings used for DICOM treatments" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/atom-one-dark.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<link rel="preconnect" href="https://www.google.com">
<script async src="https://cse.google.com/cse.js?cx=017837193012385208679:pey8ky8gdqw"></script>
<style>
.gsc-control-cse {padding:0 !important;margin-top:1em}
body.gsc-overflow-hidden #sidebar {overflow: visible;}
</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
<style>.homelink{display:block;font-size:2em;font-weight:bold;color:#555;padding-bottom:.5em;border-bottom:1px solid silver}.homelink:hover{color:inherit}.homelink img{max-width:20%;max-height:5em;margin:auto;margin-bottom:.3em}</style>
<link rel="canonical" href="https://pdoc3.github.io/pdoc/doc/radiology_ai/preprocessing/dicom.html">
<link rel="icon" href="https://pdoc3.github.io/pdoc/logo.png">
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>radiology_ai.preprocessing.dicom</code></h1>
</header>
<section id="section-intro">
<p>Preprocessings used for DICOM treatments</p>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/lluissalord/radiology_ai/blob/b7c33fd01ba487e780f388021e8ad711c37c5b7b/preprocessing\dicom.py#L0-L165" class="git-link">Browse git</a>
</summary>
<pre><code class="python">&#34;&#34;&#34; Preprocessings used for DICOM treatments &#34;&#34;&#34;

from tqdm import tqdm
import gc
import os
import shutil

import pydicom
from PIL import Image

from torch.utils.data import Dataset
import torchvision.transforms as tfms
from fastcore.transform import Transform
from fastai.data.all import Path
from fastai.medical.imaging import PILDicom

from preprocessing.misc import *


class PILDicom_scaled(PILDicom):
    &#34;&#34;&#34; Generalization of PILDicom class making sure it is properly scaled taking into account DICOM metadata &#34;&#34;&#34;

    @classmethod
    def create(cls, fn:(Path,str,bytes), mode=None)-&gt;None:
        &#34;Open a `DICOM file` from path `fn` or bytes `fn` and load it as a `PIL Image`&#34;
        if isinstance(fn,bytes): im = Image.fromarray(pydicom.dcmread(pydicom.filebase.DicomBytesIO(fn)).pixel_array)
        if isinstance(fn,(Path,str)): im = Image.fromarray(255 * dcmread_scale(fn).numpy())
        im.load()
        im = im._new(im.im)
        return cls(im.convert(mode) if mode else im)


class HistScaled_Dicom(Transform):
    &#34;&#34;&#34; Transformation of Histogram Scaling compatible with DataLoaders, allowing Histogram Scaling on the fly &#34;&#34;&#34;

    def __init__(self, bins=None):
        super().__init__()
        self.bins = bins

    def encodes(self, sample:PILDicom_scaled):
        return Image.fromarray(
            (
                sample._tensor_cls(sample) / 255.
            )
            .hist_scaled(brks=self.bins).numpy() * 255
        )


class DCMPreprocessDataset(Dataset):
    &#34;&#34;&#34; Dataset class for DCM preprocessing &#34;&#34;&#34;

    def __init__(self, fnames, resize=None, padding_to_square=True, bins=None):
        self.fnames = fnames
        self.resize = resize
        self.padding_to_square = padding_to_square
        self.bins = bins

    def __len__(self):
        return len(self.fnames)

    def __getitem__(self,  idx):
        &#34;&#34;&#34; Get sample after reading from DCM file, scale it and applying the transformations &#34;&#34;&#34;

        dcm = self.get_dcm(idx)
        
        # Treat sample even if cannot transform DCM because of missing PresentationLUTShape (so it is not a X-ray image)
        sample = dcm_scale(dcm)
    
        if self.bins is not None:
            sample = sample.hist_scaled(brks=self.bins)

        if self.padding_to_square or self.resize is not None:
            transform = [tfms.ToPILImage()]
            # sample = PILImage.create(sample)
            # transform = []

            if self.padding_to_square:
                # Prepare padding transformation to make square image
                x, y = sample.size()
                pad_to = max(x, y)
                extra_width = 0 if (pad_to - y) % 2 else 1
                extra_height = 0 if (pad_to - x) % 2 else 1
                padding = ((pad_to - y) // 2, (pad_to - x) // 2, (pad_to - y) // 2 + extra_width, (pad_to - x) // 2 + extra_height)

                transform += [tfms.Pad(padding=padding, fill=0, padding_mode=&#39;constant&#39;)]
                # transform += [CropPad(size=pad_to)] # Pending release of issue https://github.com/pytorch/vision/pull/2515

            if self.resize is not None:
                # transform += [Resize(size=self.resize)]
                transform += [tfms.Resize(size=self.resize)]

            sample = tfms.Compose(transform)(sample)
            # for tfms in transform:
            #     sample = tfms(sample)

        return sample

    def get_fname(self, idx):
        &#34;&#34;&#34; Get the filenames &#34;&#34;&#34;

        if torch.is_tensor(idx):
            idx = idx.tolist()

        return self.fnames[idx].name

    def get_dcm(self, idx):
        &#34;&#34;&#34; Get the DCM file &#34;&#34;&#34;

        if torch.is_tensor(idx):
            idx = idx.tolist()

        return self.fnames[idx].dcmread()

    def get_dcm_by_name(self, img_name):
        if img_name[-4:] != &#39;.dcm&#39;:
            img_name = img_name + &#39;.dcm&#39;

        return self.fnames.map(lambda x: x if x.name == img_name else None).filter(None)[0].dcmread()

    def init_bins(self, n_samples=None):
        &#34;&#34;&#34; Initialize bins to equally distribute the histogram of the dataset &#34;&#34;&#34;

        self.bins = init_bins(self.fnames, n_samples)
        return self.bins

    def save(self, dst_folder, extension=&#39;png&#39;, overwrite=True, keep=False, clean_folder=False):
        &#34;&#34;&#34; Saves all preprocessed files converting them into image files &#34;&#34;&#34;
        
        # Do not make sense overwrite=True with keep=True
        if overwrite and keep:
            raise ValueError(&#39;Incoherent setting of overwrite=True with keep=True&#39;)

        # Create the destination folder if not exists
        if not os.path.exists(dst_folder):
            os.makedirs(dst_folder)
        elif clean_folder:
            shutil.rmtree(dst_folder)
            os.makedirs(dst_folder)
            
        for idx in tqdm(range(len(self)), desc=&#39;Saving Images: &#39;):
            # Define filename and filepath
            filename, ext = os.path.splitext(self.get_fname(idx))

            # Take into account the ones which seems to have extension &#34;.PACSXXX&#34; is not an extension
            if ext.startswith(&#39;.PACS&#39;):
                filename = self.get_fname(idx)

            filepath = f&#39;{dst_folder}/{filename}.{extension}&#39;

            # In case the file already exists and it has to be keep, then continue with the loop
            if os.path.exists(filepath) and keep:
                continue
            
            data = self[idx]

            # Add numeration if files already exist and do not want to overwrite
            i = 1
            while not overwrite and os.path.exists(filepath):
                filepath = f&#39;{dst_folder}/{filename}_{i}.{extension}&#39;
                i += 1

            data.save(filepath, format=extension, compress_level=0 if extension.lower()==&#39;png&#39; else None)
            # save_image(data, f&#39;{dst_folder}/{filename}.{extension}&#39;)

            del data
            gc.collect()</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="radiology_ai.preprocessing.dicom.DCMPreprocessDataset"><code class="flex name class">
<span>class <span class="ident">DCMPreprocessDataset</span></span>
<span>(</span><span>fnames, resize=None, padding_to_square=True, bins=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Dataset class for DCM preprocessing</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/lluissalord/radiology_ai/blob/b7c33fd01ba487e780f388021e8ad711c37c5b7b/preprocessing\dicom.py#L49-L166" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class DCMPreprocessDataset(Dataset):
    &#34;&#34;&#34; Dataset class for DCM preprocessing &#34;&#34;&#34;

    def __init__(self, fnames, resize=None, padding_to_square=True, bins=None):
        self.fnames = fnames
        self.resize = resize
        self.padding_to_square = padding_to_square
        self.bins = bins

    def __len__(self):
        return len(self.fnames)

    def __getitem__(self,  idx):
        &#34;&#34;&#34; Get sample after reading from DCM file, scale it and applying the transformations &#34;&#34;&#34;

        dcm = self.get_dcm(idx)
        
        # Treat sample even if cannot transform DCM because of missing PresentationLUTShape (so it is not a X-ray image)
        sample = dcm_scale(dcm)
    
        if self.bins is not None:
            sample = sample.hist_scaled(brks=self.bins)

        if self.padding_to_square or self.resize is not None:
            transform = [tfms.ToPILImage()]
            # sample = PILImage.create(sample)
            # transform = []

            if self.padding_to_square:
                # Prepare padding transformation to make square image
                x, y = sample.size()
                pad_to = max(x, y)
                extra_width = 0 if (pad_to - y) % 2 else 1
                extra_height = 0 if (pad_to - x) % 2 else 1
                padding = ((pad_to - y) // 2, (pad_to - x) // 2, (pad_to - y) // 2 + extra_width, (pad_to - x) // 2 + extra_height)

                transform += [tfms.Pad(padding=padding, fill=0, padding_mode=&#39;constant&#39;)]
                # transform += [CropPad(size=pad_to)] # Pending release of issue https://github.com/pytorch/vision/pull/2515

            if self.resize is not None:
                # transform += [Resize(size=self.resize)]
                transform += [tfms.Resize(size=self.resize)]

            sample = tfms.Compose(transform)(sample)
            # for tfms in transform:
            #     sample = tfms(sample)

        return sample

    def get_fname(self, idx):
        &#34;&#34;&#34; Get the filenames &#34;&#34;&#34;

        if torch.is_tensor(idx):
            idx = idx.tolist()

        return self.fnames[idx].name

    def get_dcm(self, idx):
        &#34;&#34;&#34; Get the DCM file &#34;&#34;&#34;

        if torch.is_tensor(idx):
            idx = idx.tolist()

        return self.fnames[idx].dcmread()

    def get_dcm_by_name(self, img_name):
        if img_name[-4:] != &#39;.dcm&#39;:
            img_name = img_name + &#39;.dcm&#39;

        return self.fnames.map(lambda x: x if x.name == img_name else None).filter(None)[0].dcmread()

    def init_bins(self, n_samples=None):
        &#34;&#34;&#34; Initialize bins to equally distribute the histogram of the dataset &#34;&#34;&#34;

        self.bins = init_bins(self.fnames, n_samples)
        return self.bins

    def save(self, dst_folder, extension=&#39;png&#39;, overwrite=True, keep=False, clean_folder=False):
        &#34;&#34;&#34; Saves all preprocessed files converting them into image files &#34;&#34;&#34;
        
        # Do not make sense overwrite=True with keep=True
        if overwrite and keep:
            raise ValueError(&#39;Incoherent setting of overwrite=True with keep=True&#39;)

        # Create the destination folder if not exists
        if not os.path.exists(dst_folder):
            os.makedirs(dst_folder)
        elif clean_folder:
            shutil.rmtree(dst_folder)
            os.makedirs(dst_folder)
            
        for idx in tqdm(range(len(self)), desc=&#39;Saving Images: &#39;):
            # Define filename and filepath
            filename, ext = os.path.splitext(self.get_fname(idx))

            # Take into account the ones which seems to have extension &#34;.PACSXXX&#34; is not an extension
            if ext.startswith(&#39;.PACS&#39;):
                filename = self.get_fname(idx)

            filepath = f&#39;{dst_folder}/{filename}.{extension}&#39;

            # In case the file already exists and it has to be keep, then continue with the loop
            if os.path.exists(filepath) and keep:
                continue
            
            data = self[idx]

            # Add numeration if files already exist and do not want to overwrite
            i = 1
            while not overwrite and os.path.exists(filepath):
                filepath = f&#39;{dst_folder}/{filename}_{i}.{extension}&#39;
                i += 1

            data.save(filepath, format=extension, compress_level=0 if extension.lower()==&#39;png&#39; else None)
            # save_image(data, f&#39;{dst_folder}/{filename}.{extension}&#39;)

            del data
            gc.collect()</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>torch.utils.data.dataset.Dataset</li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="radiology_ai.preprocessing.dicom.DCMPreprocessDataset.get_dcm"><code class="name flex">
<span>def <span class="ident">get_dcm</span></span>(<span>self, idx)</span>
</code></dt>
<dd>
<div class="desc"><p>Get the DCM file</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/lluissalord/radiology_ai/blob/b7c33fd01ba487e780f388021e8ad711c37c5b7b/preprocessing\dicom.py#L106-L112" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def get_dcm(self, idx):
    &#34;&#34;&#34; Get the DCM file &#34;&#34;&#34;

    if torch.is_tensor(idx):
        idx = idx.tolist()

    return self.fnames[idx].dcmread()</code></pre>
</details>
</dd>
<dt id="radiology_ai.preprocessing.dicom.DCMPreprocessDataset.get_dcm_by_name"><code class="name flex">
<span>def <span class="ident">get_dcm_by_name</span></span>(<span>self, img_name)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/lluissalord/radiology_ai/blob/b7c33fd01ba487e780f388021e8ad711c37c5b7b/preprocessing\dicom.py#L114-L118" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def get_dcm_by_name(self, img_name):
    if img_name[-4:] != &#39;.dcm&#39;:
        img_name = img_name + &#39;.dcm&#39;

    return self.fnames.map(lambda x: x if x.name == img_name else None).filter(None)[0].dcmread()</code></pre>
</details>
</dd>
<dt id="radiology_ai.preprocessing.dicom.DCMPreprocessDataset.get_fname"><code class="name flex">
<span>def <span class="ident">get_fname</span></span>(<span>self, idx)</span>
</code></dt>
<dd>
<div class="desc"><p>Get the filenames</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/lluissalord/radiology_ai/blob/b7c33fd01ba487e780f388021e8ad711c37c5b7b/preprocessing\dicom.py#L98-L104" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def get_fname(self, idx):
    &#34;&#34;&#34; Get the filenames &#34;&#34;&#34;

    if torch.is_tensor(idx):
        idx = idx.tolist()

    return self.fnames[idx].name</code></pre>
</details>
</dd>
<dt id="radiology_ai.preprocessing.dicom.DCMPreprocessDataset.init_bins"><code class="name flex">
<span>def <span class="ident">init_bins</span></span>(<span>self, n_samples=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Initialize bins to equally distribute the histogram of the dataset</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/lluissalord/radiology_ai/blob/b7c33fd01ba487e780f388021e8ad711c37c5b7b/preprocessing\dicom.py#L120-L124" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def init_bins(self, n_samples=None):
    &#34;&#34;&#34; Initialize bins to equally distribute the histogram of the dataset &#34;&#34;&#34;

    self.bins = init_bins(self.fnames, n_samples)
    return self.bins</code></pre>
</details>
</dd>
<dt id="radiology_ai.preprocessing.dicom.DCMPreprocessDataset.save"><code class="name flex">
<span>def <span class="ident">save</span></span>(<span>self, dst_folder, extension='png', overwrite=True, keep=False, clean_folder=False)</span>
</code></dt>
<dd>
<div class="desc"><p>Saves all preprocessed files converting them into image files</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/lluissalord/radiology_ai/blob/b7c33fd01ba487e780f388021e8ad711c37c5b7b/preprocessing\dicom.py#L126-L166" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def save(self, dst_folder, extension=&#39;png&#39;, overwrite=True, keep=False, clean_folder=False):
    &#34;&#34;&#34; Saves all preprocessed files converting them into image files &#34;&#34;&#34;
    
    # Do not make sense overwrite=True with keep=True
    if overwrite and keep:
        raise ValueError(&#39;Incoherent setting of overwrite=True with keep=True&#39;)

    # Create the destination folder if not exists
    if not os.path.exists(dst_folder):
        os.makedirs(dst_folder)
    elif clean_folder:
        shutil.rmtree(dst_folder)
        os.makedirs(dst_folder)
        
    for idx in tqdm(range(len(self)), desc=&#39;Saving Images: &#39;):
        # Define filename and filepath
        filename, ext = os.path.splitext(self.get_fname(idx))

        # Take into account the ones which seems to have extension &#34;.PACSXXX&#34; is not an extension
        if ext.startswith(&#39;.PACS&#39;):
            filename = self.get_fname(idx)

        filepath = f&#39;{dst_folder}/{filename}.{extension}&#39;

        # In case the file already exists and it has to be keep, then continue with the loop
        if os.path.exists(filepath) and keep:
            continue
        
        data = self[idx]

        # Add numeration if files already exist and do not want to overwrite
        i = 1
        while not overwrite and os.path.exists(filepath):
            filepath = f&#39;{dst_folder}/{filename}_{i}.{extension}&#39;
            i += 1

        data.save(filepath, format=extension, compress_level=0 if extension.lower()==&#39;png&#39; else None)
        # save_image(data, f&#39;{dst_folder}/{filename}.{extension}&#39;)

        del data
        gc.collect()</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="radiology_ai.preprocessing.dicom.HistScaled_Dicom"><code class="flex name class">
<span>class <span class="ident">HistScaled_Dicom</span></span>
<span>(</span><span>bins=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Transformation of Histogram Scaling compatible with DataLoaders, allowing Histogram Scaling on the fly</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/lluissalord/radiology_ai/blob/b7c33fd01ba487e780f388021e8ad711c37c5b7b/preprocessing\dicom.py#L33-L46" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class HistScaled_Dicom(Transform):
    &#34;&#34;&#34; Transformation of Histogram Scaling compatible with DataLoaders, allowing Histogram Scaling on the fly &#34;&#34;&#34;

    def __init__(self, bins=None):
        super().__init__()
        self.bins = bins

    def encodes(self, sample:PILDicom_scaled):
        return Image.fromarray(
            (
                sample._tensor_cls(sample) / 255.
            )
            .hist_scaled(brks=self.bins).numpy() * 255
        )</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>fastcore.transform.Transform</li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="radiology_ai.preprocessing.dicom.HistScaled_Dicom.decodes"><code class="name flex">
<span>def <span class="ident">decodes</span></span>(<span>...)</span>
</code></dt>
<dd>
<div class="desc"><p>Dictionary-like object; <code>__getitem__</code> matches keys of types using <code>issubclass</code></p></div>
</dd>
<dt id="radiology_ai.preprocessing.dicom.HistScaled_Dicom.encodes"><code class="name flex">
<span>def <span class="ident">encodes</span></span>(<span>...)</span>
</code></dt>
<dd>
<div class="desc"><p>Dictionary-like object; <code>__getitem__</code> matches keys of types using <code>issubclass</code></p></div>
</dd>
<dt id="radiology_ai.preprocessing.dicom.HistScaled_Dicom.setups"><code class="name flex">
<span>def <span class="ident">setups</span></span>(<span>...)</span>
</code></dt>
<dd>
<div class="desc"><p>Dictionary-like object; <code>__getitem__</code> matches keys of types using <code>issubclass</code></p></div>
</dd>
</dl>
</dd>
<dt id="radiology_ai.preprocessing.dicom.PILDicom_scaled"><code class="flex name class">
<span>class <span class="ident">PILDicom_scaled</span></span>
</code></dt>
<dd>
<div class="desc"><p>Generalization of PILDicom class making sure it is properly scaled taking into account DICOM metadata</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/lluissalord/radiology_ai/blob/b7c33fd01ba487e780f388021e8ad711c37c5b7b/preprocessing\dicom.py#L20-L30" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class PILDicom_scaled(PILDicom):
    &#34;&#34;&#34; Generalization of PILDicom class making sure it is properly scaled taking into account DICOM metadata &#34;&#34;&#34;

    @classmethod
    def create(cls, fn:(Path,str,bytes), mode=None)-&gt;None:
        &#34;Open a `DICOM file` from path `fn` or bytes `fn` and load it as a `PIL Image`&#34;
        if isinstance(fn,bytes): im = Image.fromarray(pydicom.dcmread(pydicom.filebase.DicomBytesIO(fn)).pixel_array)
        if isinstance(fn,(Path,str)): im = Image.fromarray(255 * dcmread_scale(fn).numpy())
        im.load()
        im = im._new(im.im)
        return cls(im.convert(mode) if mode else im)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>fastai.medical.imaging.PILDicom</li>
<li>fastai.vision.core.PILBase</li>
<li>PIL.Image.Image</li>
</ul>
<h3>Static methods</h3>
<dl>
<dt id="radiology_ai.preprocessing.dicom.PILDicom_scaled.create"><code class="name flex">
<span>def <span class="ident">create</span></span>(<span>fn: (<class 'pathlib.Path'>, <class 'str'>, <class 'bytes'>), mode=None) ‑> NoneType</span>
</code></dt>
<dd>
<div class="desc"><p>Open a <code>DICOM file</code> from path <code>fn</code> or bytes <code>fn</code> and load it as a <code>PIL Image</code></p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/lluissalord/radiology_ai/blob/b7c33fd01ba487e780f388021e8ad711c37c5b7b/preprocessing\dicom.py#L23-L30" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@classmethod
def create(cls, fn:(Path,str,bytes), mode=None)-&gt;None:
    &#34;Open a `DICOM file` from path `fn` or bytes `fn` and load it as a `PIL Image`&#34;
    if isinstance(fn,bytes): im = Image.fromarray(pydicom.dcmread(pydicom.filebase.DicomBytesIO(fn)).pixel_array)
    if isinstance(fn,(Path,str)): im = Image.fromarray(255 * dcmread_scale(fn).numpy())
    im.load()
    im = im._new(im.im)
    return cls(im.convert(mode) if mode else im)</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<div class="gcse-search" style="height: 70px"
data-as_oq="inurl:github.com/lluissalord/radiology_ai site:radiology_ai.github.io site:radiology_ai.website"
data-gaCategoryParameter="radiology_ai.preprocessing.dicom">
</div>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="radiology_ai.preprocessing" href="index.html">radiology_ai.preprocessing</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="radiology_ai.preprocessing.dicom.DCMPreprocessDataset" href="#radiology_ai.preprocessing.dicom.DCMPreprocessDataset">DCMPreprocessDataset</a></code></h4>
<ul class="">
<li><code><a title="radiology_ai.preprocessing.dicom.DCMPreprocessDataset.get_dcm" href="#radiology_ai.preprocessing.dicom.DCMPreprocessDataset.get_dcm">get_dcm</a></code></li>
<li><code><a title="radiology_ai.preprocessing.dicom.DCMPreprocessDataset.get_dcm_by_name" href="#radiology_ai.preprocessing.dicom.DCMPreprocessDataset.get_dcm_by_name">get_dcm_by_name</a></code></li>
<li><code><a title="radiology_ai.preprocessing.dicom.DCMPreprocessDataset.get_fname" href="#radiology_ai.preprocessing.dicom.DCMPreprocessDataset.get_fname">get_fname</a></code></li>
<li><code><a title="radiology_ai.preprocessing.dicom.DCMPreprocessDataset.init_bins" href="#radiology_ai.preprocessing.dicom.DCMPreprocessDataset.init_bins">init_bins</a></code></li>
<li><code><a title="radiology_ai.preprocessing.dicom.DCMPreprocessDataset.save" href="#radiology_ai.preprocessing.dicom.DCMPreprocessDataset.save">save</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="radiology_ai.preprocessing.dicom.HistScaled_Dicom" href="#radiology_ai.preprocessing.dicom.HistScaled_Dicom">HistScaled_Dicom</a></code></h4>
<ul class="">
<li><code><a title="radiology_ai.preprocessing.dicom.HistScaled_Dicom.decodes" href="#radiology_ai.preprocessing.dicom.HistScaled_Dicom.decodes">decodes</a></code></li>
<li><code><a title="radiology_ai.preprocessing.dicom.HistScaled_Dicom.encodes" href="#radiology_ai.preprocessing.dicom.HistScaled_Dicom.encodes">encodes</a></code></li>
<li><code><a title="radiology_ai.preprocessing.dicom.HistScaled_Dicom.setups" href="#radiology_ai.preprocessing.dicom.HistScaled_Dicom.setups">setups</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="radiology_ai.preprocessing.dicom.PILDicom_scaled" href="#radiology_ai.preprocessing.dicom.PILDicom_scaled">PILDicom_scaled</a></code></h4>
<ul class="">
<li><code><a title="radiology_ai.preprocessing.dicom.PILDicom_scaled.create" href="#radiology_ai.preprocessing.dicom.PILDicom_scaled.create">create</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.2</a>.</p>
</footer>
</body>
</html>